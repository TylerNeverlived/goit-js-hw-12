{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport axios from 'axios';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst refs = {\n  formEl: document.querySelector('.js-search-form'),\n  imgEl: document.querySelector('.js-image-container'),\n  loaderEl: document.querySelector('.loader'),\n  loadMoreBtn: document.querySelector('.load-more-btn'),\n  loaderBottom: document.querySelector('.loadMore'),\n};\n\nlet currentPage = 1;\nlet currentQuery = '';\n\nif (refs.formEl) {\n  refs.formEl.addEventListener('submit', onFormSubmit);\n}\n\nif (refs.loadMoreBtn) {\n  refs.loadMoreBtn.addEventListener('click', loadMoreImages);\n}\n\nasync function onFormSubmit(e) {\n  e.preventDefault();\n  currentPage = 1;\n  currentQuery = e.target.elements.text.value.trim();\n\n  if (!currentQuery) {\n    iziToast.error({\n      position: 'topRight',\n      message: 'Please enter a search query!',\n    });\n    return;\n  }\n\n  // toggleLoader(true);\n  toggleLoadMore(true);\n\n  try {\n    const data = await getImg(currentQuery, currentPage);\n    renderImg(data);\n    if (data.hits.length === 0) {\n      iziToast.info({\n        position: 'topRight',\n        message: 'No images found for the entered query.',\n      });\n      toggleLoader(false);\n      toggleLoadMore(false);\n      toggleLoadMoreButton(false);\n    } else if (data.hits.length < 15) {\n      toggleLoadMoreButton(false);\n      toggleLoader(false);\n    } else {\n      toggleLoadMoreButton(true);\n      toggleLoader(false);\n      toggleLoadMore(false);\n      currentPage++;\n    }\n  } catch (error) {\n    console.error('Error fetching images:', error);\n    iziToast.error({\n      position: 'topRight',\n      message: 'Failed to fetch images. Please try again later.',\n    });\n    toggleLoader(false);\n    toggleLoadMoreButton(false);\n    toggleLoadMore(false);\n    clearGallery();\n  } finally {\n    e.target.elements.text.value = '';\n  }\n}\n\nasync function loadMoreImages() {\n  try {\n    toggleLoadMoreButton(false);\n    toggleLoadMore(true);\n    const data = await getImg(currentQuery, currentPage);\n    renderImg(data);\n\n    if (data.hits.length < 15) {\n      toggleLoadMore(false);\n      toggleLoadMoreButton(false);\n      iziToast.show({\n        title: '',\n        message: \"We're sorry, but you've reached the end of search results.\",\n        color: 'red',\n        position: 'topRight',\n      });\n    } else {\n      toggleLoadMoreButton(true);\n      currentPage++;\n    }\n  } catch (error) {\n    console.error('Error fetching more images:', error);\n    iziToast.error({\n      position: 'topRight',\n      message: 'Failed to fetch more images. Please try again later.',\n    });\n  }\n}\n\nasync function getImg(query, page = 1) {\n  const BASE_URL = 'https://pixabay.com/api/';\n  const API_KEY = '42295751-6e09ed05d50a99192d667c3e9';\n\n  try {\n    const response = await axios.get(BASE_URL, {\n      params: {\n        key: API_KEY,\n        q: query,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n        page: page,\n        per_page: 15,\n      },\n    });\n\n    return response.data;\n  } catch (error) {\n    throw new Error('Failed to fetch images');\n  }\n}\n\nfunction imgTemplate(photo) {\n  return `\n        <a href=\"${photo.largeImageURL}\" class=\"photo-container\" data-lightbox=\"photos\">\n            <img\n                src=\"${photo.webformatURL}\"\n                alt=\"${photo.tags}\"\n                class=\"photo\"\n            />\n            \n            <div class=\"photo-body\">\n                <p class=\"photo-name\">Likes ${photo.likes}</p>\n                <p class=\"photo-name\">Views ${photo.views}</p>\n                <p class=\"photo-name\">Comments ${photo.comments}</p>\n                <p class=\"photo-name\">Downloads ${photo.downloads}</p>\n            </div>\n        </a>\n    `;\n}\n\nfunction renderImg(data) {\n  if (currentPage === 1) {\n    clearGallery();\n  }\n  refs.imgEl.innerHTML += data.hits.map(img => imgTemplate(img)).join('');\n\n  const lightbox = new SimpleLightbox('[data-lightbox=\"photos\"]');\n  lightbox.refresh();\n\n  // toggleLoadMoreButton(true);\n  toggleLoadMore(false);\n  smoothScrollToNextImages();\n}\n\nfunction smoothScrollToNextImages() {\n  const galleryItem = document.querySelector('.photo-container');\n  if (galleryItem) {\n    const cardHeight = galleryItem.getBoundingClientRect().height;\n    const scrollAmount = cardHeight * 2;\n\n    window.scrollBy({\n      top: scrollAmount,\n      behavior: 'smooth',\n    });\n  }\n}\n\nfunction clearGallery() {\n  refs.imgEl.innerHTML = '';\n}\n\nfunction toggleLoader(isVisible) {\n  refs.loaderEl.style.display = isVisible ? 'inline-block' : 'none';\n}\n\nfunction toggleLoadMoreButton(isVisible) {\n  refs.loadMoreBtn.style.display = isVisible ? 'block' : 'none';\n}\n\nfunction toggleLoadMore(isVisible) {\n  refs.loaderBottom.style.display = isVisible ? 'inline-block' : 'none';\n}\n"],"names":["refs","currentPage","currentQuery","onFormSubmit","loadMoreImages","iziToast","toggleLoadMore","data","getImg","renderImg","toggleLoader","toggleLoadMoreButton","error","clearGallery","query","page","BASE_URL","API_KEY","axios","imgTemplate","photo","img","SimpleLightbox","smoothScrollToNextImages","galleryItem","scrollAmount","isVisible"],"mappings":"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"}